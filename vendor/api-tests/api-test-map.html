<div class="ui vertical menu">
  <iframe id="testframe"
    src="../../api-test-map/51099a34-7b54-487e-868d-c44290edcded?lat=58.03537122378858&lng=56.19266510009766&zoom=11"
    width="1000" height="800" align="left">
  </iframe>
  <button id="showLayers">Show Layers</button>
  <button id="hideLayers">Hide Layers</button>
  <button id="queryLayers">Query Layers</button>
  <button id="getIntersectionObjects">get Intersection Objects</button>
  <button id="createNewlayer">Create new Layer</button>
  <button id="showAllLayerObjects">Show all layer objects</button>
  <button id="isContainsObject">Is Contains Object</button>
  <button id="extendsAreaObject">Get Extended Area</button>
  <div>
    <textarea id="layerObjects" name="text" style="width:750px;height:100px"></textarea>
    <br />
    <button id="deleteLayerObjects">Delete object/objects</button>
    <button id="showObjects">Show Objects</button>
    <button id="hideObjects">Hide Objects</button>
  </div>
  <button id="moveObjectToLayer">Move Object To Layer</button>
  <button id="copyObject"> Copy Object</button>
  <button id="creatObject"> Create Object</button>
  <button id="getRhumb"> Get Rhumb</button>
  <script type="text/javascript">
    var frame = document.getElementById("testframe");
    frame.addEventListener("load", function () {
      if (frame.contentWindow.mapApi == undefined) {
        frame.contentWindow.mapApi = {};
      }

      frame.contentWindow.mapApi.goToEditForm = function (layerId, objectId) {
        console.log(`Go to edit form for element ${objectId}.`);
      }

      frame.contentWindow.mapApi.hasEditForm = function (layerId, objectId) {
        return true;
      }

      frame.contentWindow.mapApi.goToListForm = function (layerId, objectIds) {
        console.log(`Go to list form for elements ${objectIds}.`);
      }

      frame.contentWindow.mapApi.hasListForm = function (layerId) {
        return true;
      }

      frame.contentWindow.mapApi.layerInitCallback = function (model) {
        model.getLeafletObject().then(function (layer) {
          layer.eachLayer(function (layerr) {
            if (!Ember.IsNone(layerr.setStyle)) {
              switch (model.layerModel.get('id')) {
                case 'f7670a1f-1acb-4571-923c-1ce3bc88e11e':
                  layerr.setStyle({ color: '#808000', fillColor: '#FFD700' });
                  break;
                case 'f8dec493-d879-49ae-ad55-f4f18c89cb88':
                  layerr.setStyle({ color: '#008B8B' });
                  break;
              }
            }
            layerr.on('click', function (e) {
              alert(e.target.feature.properties.name);
            })
          });
        });
      };
      frame.contentWindow.mapApi.getLayerFeatureId = function (layer, layerObject) {
        if (layer.id === "f7670a1f-1acb-4571-923c-1ce3bc88e11e") {
          return layerObject.feature.properties.name;
        }
        return layerObject.feature.id;
      }

      var showButton = document.getElementById('showLayers');
      var showLayers = function () {
        frame.contentWindow.mapApi.mapModel.showLayers(['f7670a1f-1acb-4571-923c-1ce3bc88e11e', 'f8dec493-d879-49ae-ad55-f4f18c89cb88']);
      };
      showButton.addEventListener('click', showLayers);

      var hideButton = document.getElementById('hideLayers');
      var hideLayers = function () {
        frame.contentWindow.mapApi.mapModel.hideLayers(['f7670a1f-1acb-4571-923c-1ce3bc88e11e', 'f8dec493-d879-49ae-ad55-f4f18c89cb88']);
      };
      hideButton.addEventListener('click', hideLayers);

      var queryButton = document.getElementById('queryLayers');
      var queryLayers = function () {
        frame.contentWindow.mapApi.runQuery({ waterway: 'drain', name: 'Гайва' }, 'c2ce814e-cb31-432e-af9e-2e86cea65c67');
      };
      queryButton.addEventListener('click', queryLayers);

      var intersectionButton = document.getElementById('getIntersectionObjects');
      var getIntersections = function () {
        console.log(frame.contentWindow.mapApi.mapModel.getIntersectionObjects('perm_water_line.7836', ['f8dec493-d879-49ae-ad55-f4f18c89cb88']));
      };
      intersectionButton.addEventListener('click', getIntersections);

      var newLayerButton = document.getElementById('createNewlayer');
      var newLayer = function () {
        frame.contentWindow.mapApi.mapModel.createNewLayer({ name: 'test_osm', type: 'osm' }).then(id => console.log(id));
      };
      newLayerButton.addEventListener('click', newLayer);

      textaeraDelObj = {
        layerId: 'f8dec493-d879-49ae-ad55-f4f18c89cb88', objectIds: ['perm_water_line.8383', 'perm_water_line.8382']
      };
      layerObjects.value = JSON.stringify(textaeraDelObj);

      var deleteObjectsLayerButton = document.getElementById('deleteLayerObjects');
      var deleteObjectsLayer = function () {
        var layerObjects = document.getElementById('layerObjects');
        var delObj = JSON.parse(layerObjects.value);

        if (delObj.layerId !== undefined) {
          var promise;
          if (delObj.objectIds.length > 1) {
            promise = frame.contentWindow.mapApi.mapModel.deleteLayerObjects(delObj.layerId, delObj.objectIds);
          } else if (delObj.objectIds.length === 1) {
            promise = frame.contentWindow.mapApi.mapModel.deleteLayerObject(delObj.layerId, delObj.objectIds[0]);
          }

          promise.then(() => console.log(delObj.objectIds)).catch(() => console.log('Layer saving failed'));
        }
      };

      deleteObjectsLayerButton.addEventListener('click', deleteObjectsLayer);

      var showObjectsButton = document.getElementById('showObjects');
      var showObjects = function () {
        var layerObjects = document.getElementById('layerObjects');
        var visibilityObj = JSON.parse(layerObjects.value);

        if (visibilityObj.layerId !== undefined) {
          if (visibilityObj.objectIds.length > 0) {
            frame.contentWindow.mapApi.mapModel.showLayerObjects(visibilityObj.layerId, visibilityObj.objectIds);
          }
        };
      };

      showObjectsButton.addEventListener('click', showObjects);

      var hideObjectsButton = document.getElementById('hideObjects');
      var hideObjects = function () {
        var layerObjects = document.getElementById('layerObjects');
        var visibilityObj = JSON.parse(layerObjects.value);

        if (visibilityObj.layerId !== undefined) {
          if (visibilityObj.objectIds.length > 0) {
            frame.contentWindow.mapApi.mapModel.hideLayerObjects(visibilityObj.layerId, visibilityObj.objectIds);
          }
        };
      }

      hideObjectsButton.addEventListener('click', hideObjects);

      var showAllLayerObjectsButton = document.getElementById('showAllLayerObjects');
      var showAllLayerObjects = function () {
        frame.contentWindow.mapApi.mapModel.showAllLayerObjects('f8dec493-d879-49ae-ad55-f4f18c89cb88');
      }

      showAllLayerObjectsButton.addEventListener('click', showAllLayerObjects);

      var moveButton = document.getElementById('moveObjectToLayer');
      var moveObject = function () {
        let promise = frame.contentWindow.mapApi.mapModel.moveObjectToLayer('perm_water_polygon.8238', 'cd68892e-2896-47e0-b0e1-28dd700bad87', 'f8dec493-d879-49ae-ad55-f4f18c89cb88');
        promise.then(resolve => { console.log(resolve) }, reject => {
          console.log(reject);
        })
      };
      moveButton.addEventListener('click', moveObject);

      var copyButton = document.getElementById('copyObject');
      var copyObject = function () {
        frame.contentWindow.mapApi.mapModel.copyObject('perm_water_polygon.8000', 'cd68892e-2896-47e0-b0e1-28dd700bad87', 'f8dec493-d879-49ae-ad55-f4f18c89cb88')
          .then(() => { console.log('layer copied successfully') }, reject => { console.log(reject) })
      };
      copyButton.addEventListener('click', copyObject);

      var containsButton = document.getElementById('isContainsObject');
      var containsObject = function () {
        let layerId = "f7670a1f-1acb-4571-923c-1ce3bc88e11e"
        let isContains = frame.contentWindow.mapApi.mapModel.isContainsObject('Малые реки', layerId, 'Голованово', layerId)
        console.log("layer 'Голованово' contains layer 'Малые реки':" + isContains);
      };
      containsButton.addEventListener('click', containsObject);

      var extendsAreaButton = document.getElementById('extendsAreaObject');
      var extendsObject = function () {
        let layerId = "f7670a1f-1acb-4571-923c-1ce3bc88e11e"
        let area = frame.contentWindow.mapApi.mapModel.getAreaExtends('Малые реки', layerId, 'Голованово', layerId)
        console.log("the area of ​​layer 'Голованово' that extends beyond the boundaries of layer 'Малые реки':" + area);
      };
      extendsAreaButton.addEventListener('click', extendsObject);

      var creatObjectButton = document.getElementById('creatObject');
      var creatObjectLayers = function () {
        frame.contentWindow.mapApi.createObject({ PK: '3059', nomer: '10' }, 'c2ce814e-cb31-432e-af9e-2e86cea65c67');
      };
      creatObjectButton.addEventListener('click', creatObjectLayers);
    });

    var getRhumbButton = document.getElementById('getRhumb');
    var getRhumb = function () {
      var thumbs = frame.contentWindow.mapApi.mapModel.getRhumb('56f4b518-e375-4b24-be2f-88d48110c0a3', 'vydel_polygon.3093');
      console.log(thumbs);
    }

    getRhumbButton.addEventListener('click', getRhumb);

  </script>
</div>
