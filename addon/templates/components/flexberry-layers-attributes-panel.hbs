<div class={{concat "ui very wide bottom bottompanel pushable tabbar" (if folded " folded" "") (if settings.withToolbar " withToolbar" "") (if settings.sidebarOpened " sidebarOpened" "")}}>
  <button class="bottompanel-tab-nav-button bottompanel-tab-nav-button-left"
    {{action "onTabMove" true}}>
    <i class="left arrow icon"></i>
  </button>
  <div class="bottompanel-tab-nav-panel">
    <div class="ui top attached tabular menu bottompanel-tab-nav-panel-tabs">
      {{#each _tabModels key="name" as |tabModel index|}}
      <a class={{concat "bottompanel tab item"
        (if (eq selectedTabIndex index) " active" "")}} data-tab="{{tabModel.name}}"
        {{action "onTabSelect" index}}>
        {{tabModel.name}}
        <i class="icon close" {{action "closeTab" index bubbles=false}}></i>
      </a>
      {{/each}}
    </div>
  </div>
  <button
    class="bottompanel-tab-nav-button bottompanel-tab-nav-button-right"
    {{action "onTabMove" false}}>
    <i class="right arrow icon"></i>
  </button>

  {{#each _tabModels key="name" as |tabModel index|}}
  <div data-tab="{{tabModel.name}}"
    class={{concat "ui bottom attached tab segment bottompanel-tab-data-panel"
    (if (eq selectedTabIndex index) " active" "")}}>

      {{#flexberry-table
        allowEdit="true"
        perPageAvailable=false
        model=tabModel.propertiesToShow
        header=tabModel.header
        recordsTotalCount=tabModel.properties.length
        fieldTypes=tabModel.leafletObject.readFormat.featureType.fieldTypes
        getData=(action "onTabGetData" tabModel)}}

        {{#block-slot "head-block"}}
          <div class="bottompanel-tab-head-panel">
            {{flexberry-checkbox
              label=(if tabModel.selectAll (t "components.flexberry-layers-attributes-panel.clear") (t "components.flexberry-layers-attributes-panel.select-all"))
              value=tabModel.selectAll
              onChange=(action "onSelectAllClick" tabModel)
              class=(if (eq tabModel.properties.length 0) "disabled") }}
            <div class="buttons">
              {{flexberry-button
                tooltip=(t "components.flexberry-layers-attributes-panel.select-feature")
                click=(action "onFindItemClick" tabModel)
                iconClass="marker icon"
                readonly=(eq tabModel._selectedRowsCount 0) }}
              {{flexberry-button
                tooltip=(t "components.flexberry-layers-attributes-panel.clear-found")
                click=(action "onClearFoundItemClick")
                iconClass="trash icon"
              }}
              {{flexberry-button
                tooltip=(t "components.flexberry-layers-attributes-panel.delete-selected")
                click=(action "onDeleteItemClick" tabModel)
                iconClass="remove icon"
                readonly=(eq tabModel._selectedRowsCount 0) }}

              <div style="height: 35px; color: #7ba7d9; background: #fff; border-radius: 5px; border: 1px solid #7ba7d9; display: inline-block;">
                <div class="ui simple dropdown item" style="line-height: 30px; margin: 1.8px 5px;">
                  <i class="plus icon"></i>
                  <i class="dropdown icon"></i>
                  <div class="menu">
                    {{#if (array-contains tabModel.availableDrawTools "marker")}}
                      <a class="item" onclick={{action "onGeometryTypeSelect" tabModel "marker"}}>
                        <i class="flexberry-map-tool-icon marker icon"></i>
                        Marker
                      </a>
                    {{/if}}
                    {{#if (array-contains tabModel.availableDrawTools "polyline")}}
                      <a class="item" onclick={{action "onGeometryTypeSelect" tabModel "polyline"}}>
                        <i class="flexberry-map-tool-icon empty star icon"></i>
                        Polyline
                      </a>
                    {{/if}}
                    {{#if (array-contains tabModel.availableDrawTools "circle")}}
                      <a class="item" onclick={{action "onGeometryTypeSelect" tabModel "circle"}}>
                        <i class="flexberry-map-tool-icon circle icon"></i>
                        Circle
                      </a>
                    {{/if}}
                    {{#if (array-contains tabModel.availableDrawTools "rectangle")}}
                      <a class="item" onclick={{action "onGeometryTypeSelect" tabModel "rectangle"}}>
                        <i class="flexberry-map-tool-icon square icon"></i>
                        Rectangle
                      </a>
                    {{/if}}
                    {{#if (array-contains tabModel.availableDrawTools "polygon")}}
                      <a class="item" onclick={{action "onGeometryTypeSelect" tabModel "polygon"}}>
                        <i class="flexberry-map-tool-icon star icon"></i>
                        Polygon
                      </a>
                    {{/if}}
                  </div>
                </div>
              </div>
              {{flexberry-button
                tooltip="Сохранить изменения"
                click=(action "onSaveChangesClick" tabModel)
                iconClass="save icon"
                readonly=false
              }}

            </div>
          </div>
        {{/block-slot}}

        {{#block-slot "column-header-head-0"}}
          <th class="narrow">{{t "components.flexberry-layers-attributes-panel.select-item"}}</th>
        {{/block-slot}}

        {{#block-slot "column-header-head-1"}}
          <th class="narrow">{{t "components.flexberry-layers-attributes-panel.edit-item"}}</th>
        {{/block-slot}}

        {{#block-slot "column-cell-head-0" as |row|}}
          <td class="narrow">
          {{flexberry-checkbox
            value=(get tabModel._selectedRows (ember-guid row))
            onChange=(action "onRowSelect" tabModel (ember-guid row)) }}
          </td>
        {{/block-slot}}

        {{#block-slot "column-cell-head-1" as |row|}}
          <td>
            {{flexberry-button
              class="small-button"
              tooltip=(t "components.flexberry-layers-attributes-panel.edit-item")
              click=(action "onRowEdit" tabModel (ember-guid row))
              iconClass="edit icon"
            }}
            {{flexberry-button
              class=(concat "small-button" (if (get tabModel._editedRows (ember-guid row)) " active" ""))
              tooltip="Редактировать геометрию"
              click=(action "onRowGeometryEdit" tabModel (ember-guid row))
              iconClass="move icon"
            }}
          </td>
        {{/block-slot}}

      {{/flexberry-table}}

  </div>
  {{/each}}
</div>

{{!--
  Semantic UI modal dialogs takes long time to be initialized
  so include each dialog in the markup only if dialog has been requested by user (similar "lazy load").
--}}
{{#if _editRowDialogHasBeenRequested}}
  {{component "layers-dialogs/attributes/edit"
    class=flexberryClassNames.addDialog
    visible=_onEditRowDialogIsVisible
    data=_editRowDataCopy
    fieldTypes=_editRowFieldTypes
    fieldParsers=_editRowFieldParsers
    approve=(action "onEditRowDialogApprove")
  }}
{{/if}}
{{#if _newRowDialogHasBeenRequested}}
  {{component "layers-dialogs/attributes/edit"
    class=flexberryClassNames.addDialog
    visible=_newRowDialogIsVisible
    data=_newRowData
    fieldTypes=_newRowFieldTypes
    fieldParsers=_newRowFieldParsers
    approve=(action "onNewRowDialogApprove")
    deny=(action "onNewRowDialogDeny")
  }}
{{/if}}
