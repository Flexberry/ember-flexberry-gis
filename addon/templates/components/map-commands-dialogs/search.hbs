{{#flexberry-dialog class=(concat class " " flexberryClassNames.prefix)
  caption=caption
  approveButtonCaption=approveButtonCaption
  denyButtonCaption=denyButtonCaption
  visible=visible
  approve=(action "onApprove")
  deny=(action "onDeny")
  beforeShow=(action "onBeforeShow")
  beforeHide=(action "onBeforeHide")
  show=(action "onShow")
  hide=(action "onHide")
}}
{{ui-message
  type="error"
  closeable=true
  visible=showErrorMessage
  caption=errorMessageCaption
  message=errorMessage
  onShow=(action "onErrorMessageShow")
  onHide=(action "onErrorMessageHide")
}}
<form class="ui {{if isBusy "loading"}} form" role="form">
  <div class="ui two column celled grid">
    <div class="{{flexberryClassNames.settings}} column">
      <div class="field">
        <label>
          {{layersDropdownCaption}}
        </label>
        {{flexberry-layers-dropdown
          class="fluid"
          operations=(array "search")
          layers=layers
          value=_selectedLayer
          layerChange=(action "onLayersDropdownLayerChange")
          availableLayersChange=(action "onLayersDropdownAvailableLayersChange")
        }}
      </div>
      {{#if _selectedLayerTypeIsValid}}
        {{component (concat "map-commands-dialogs/search-settings/" _selectedLayer.type)
          settings=_options
          layer=_selectedLayer
          layers=layers
          leafletMap=leafletMap
        }}
      {{/if}}
    </div>
    <div class="{{flexberryClassNames.results}} column">
      <div class="field">
        <label>
          {{foundedFeaturesSegmentCaption}}
        </label>
        {{#if _hasFoundedFeatures}}
          {{#if (eq foundedFeatures.length 0)}}
            {{foundedFeaturesSegmentNothingFoundMessage}}
          {{else}}
            <table class="ui celled table">
              <thead>
                <tr>
                  <th class="collapsing">
                    {{flexberry-ddau-checkbox
                      value=_allFoundedFeaturesAreSelected
                      change=(action "onSelectAllFeaturesCheckboxChange")
                    }}
                    {{flexberry-button
                      iconClass="map icon"
                      click=(action "onShowAllFeaturesButtonClick")
                    }}
                  </th>
                  {{#each-in foundedFeatures.0.properties as |propertyName propertyValue|}}
                    <th>
                      {{propertyName}}
                    </th>
                  {{/each-in}}
                </tr>
              </thead>
              <tbody>
                {{#each foundedFeatures as |feature featureIndex|}}
                  <tr>
                  <td class="collapsing">
                    {{flexberry-ddau-checkbox
                      value=feature._selected
                      change=(action "onSelectFeatureCheckboxChange" featureIndex)
                    }}
                    {{flexberry-button
                      iconClass="map icon"
                      click=(action "onShowFeatureButtonClick" featureIndex)
                    }}
                  </td>
                    {{#each-in feature.properties as |propertyName propertyValue|}}
                      <td>
                        {{propertyValue}}
                      </td>
                    {{/each-in}}
                  </tr>
                {{/each}}
              </tbody>
            </table>
          {{/if}}
        {{/if}}
      </div>
    </div>
  </div>
</form>
{{/flexberry-dialog}}
